<!DOCTYPE html>
<html lang="en">
<head>
        <title>Simple and funky Web map printing</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://blog.mathieu-leplatre.info/theme/css/main.css" type="text/css" />
        <link href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mathieu Leplatre Atom Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie.css"/>
                <script src="http://blog.mathieu-leplatre.info/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="https://github.com/leplatrem">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://blog.mathieu-leplatre.info/">Mathieu Leplatre </a></h1>
                <nav><ul>
                    <li><a href="http://blog.mathieu-leplatre.info/pages/about.html">About</a></li>
                    <li class="active"><a href="http://blog.mathieu-leplatre.info/category/dev.html">Dev</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/personal.html">Personal</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/sys.html">Sys</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/ux.html">Ux</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://blog.mathieu-leplatre.info/simple-and-funky-web-map-printing.html" rel="bookmark"
           title="Permalink to Simple and funky Web map printing">Simple and funky Web map printing</a></h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="leplatrem">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-05-02T00:00:00+02:00">
                Wed 02 May 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.mathieu-leplatre.info/author/mathieu-leplatre.html">Mathieu Leplatre</a>
        </address>
<p>In <a href="http://blog.mathieu-leplatre.info/category/dev.html">Dev</a>. </p>
<p>tags: <a href="http://blog.mathieu-leplatre.info/tag/print.html">print</a><a href="http://blog.mathieu-leplatre.info/tag/django.html">django</a><a href="http://blog.mathieu-leplatre.info/tag/web.html">web</a><a href="http://blog.mathieu-leplatre.info/tag/gis.html">gis</a><a href="http://blog.mathieu-leplatre.info/tag/django-screamshot.html">django-screamshot</a></p>
</footer><!-- /.post-info -->      <p>Strangely, users still insist in having Web page print capabilities, mostly to
share, export or archive what they see. Even if relevant permalinks are
often acceptable, we can't always dissuade them from printing :)</p>
<p>And when it comes to Web maps, printing can be a nightmare ! Even though most of the time,
the needs involve a nice landscape PDF file with the map, a legend and the company logo.
For this, designing CSS print stylesheets and using the browser <em>print</em> shortcut is not always
helpful.</p>
<p>I present here a simple solution <a class="footnote-reference" href="#id2" id="id1">[1]</a> based on headless Webkit screenshots, permalinks,
SVG templates (<em>WYSIWYG</em>), and PDF conversion.</p>
<div class="section" id="what-you-see-is-what-you-print">
<h2>What You See Is What You Print</h2>
<p>In the following (short) video, we can see :</p>
<ul class="simple">
<li>a map with dynamic content (<em>GeoJSON</em>), bound to a form for attribute filtering and a legend
refreshed upon data ranges modifications ;</li>
<li>a <em>Print</em> button that delivers the current view as <em>PDF</em> ;</li>
<li>a landscape printout in which the map view, the legend, the filter form values were nicely inserted.</li>
</ul>
<video id="webprint" width="560" controls="controls">
  <source src="http://mathieu-leplatre.info/media/20120501-print.ogv" type="video/ogg" />
  Your browser does not support the video tag.
</video><p>(<em>BTW, small boo-boo in last screen: 'montain' instead of 'mountain'</em>)</p>
</div>
<div class="section" id="kids-you-can-do-this-at-home">
<h2>Kids, you can do this at home</h2>
<p>Here is how we did it :</p>
<ul class="simple">
<li>a Web page with a &quot;stateful&quot; permalink (<em>i.e. restore the map and page state using anchors, location hash, etc. ;</em>).
Backbone.js &amp; co. are meant for this ;</li>
<li>A color scale built client-side from the resulting dataset, using <a class="reference external" href="https://github.com/gka/chroma.js">Chroma.js</a>,
to colorize the map items and populate the legend entries ;</li>
<li><a class="reference external" href="https://github.com/makinacorpus/django-screamshot">django-screamshot</a>, a Web page
screenshot application, relying on <a class="reference external" href="http://casperjs.org/">CasperJS</a>. Spooky! ;</li>
<li>a SVG landscape A4 document, edited with <em>Inkscape</em>, as a Django template in which we placed simple tags (<tt class="docutils literal">{{ filter.age_min }}</tt>) for texts,
the <tt class="docutils literal">{% base64capture %}</tt> tag for the map screenshot, and a couple of arithmetics tags to
recreate a nice vectorial legend using the color scale entries;</li>
<li>a Django view that receives the current page context (posted in <em>JS</em>), renders the SVG (<em>will thus perform the screenshot</em>),
and converts it to PDF ;</li>
</ul>
<p>Quite straightforward, a couple of hours to put together, relatively easy
to deploy, obviously meet most users needs... these hacks are our happiness !</p>
<p>If you want to know more about some missing parts, feel free to ask ! I could release stuff or just post some snippets...</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>from now on, I shall precise : even if it can cover most needs, it won't be adequate in all situations.</td></tr>
</tbody>
</table>
</div>

    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "simple-and-funky-web-map-printing.html";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://mathieuleplatre.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="http://www.linkedin.com/in/leplatre">LinkedIn</a></li>
                            <li><a href="https://code.launchpad.net/~mathieu.leplatre">Launchpad</a></li>
                            <li><a href="https://github.com/leplatrem">GitHub</a></li>
                            <li><a href="https://plus.google.com/u/0/106965745149150173373">Google+</a></li>
                            <li><a href="http://twitter.com/leplatrem">Twitter</a></li>
                            <li><a href="http://identi.ca/leplatrem">Identi.ca</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://mathieu-leplatre.info/piwik/" : "http://mathieu-leplatre.info/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://mathieu-leplatre.info/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<script type="text/javascript">
    var disqus_shortname = 'mathieuleplatre';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>