<!DOCTYPE html>
<html lang="en">
<head>
        <title>Mathieu Leplatre - debian</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://blog.mathieu-leplatre.info/theme/css/main.css" type="text/css" />
        <link href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mathieu Leplatre Atom Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie.css"/>
                <script src="http://blog.mathieu-leplatre.info/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="https://github.com/leplatrem">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://blog.mathieu-leplatre.info/">Mathieu Leplatre </a></h1>
                <nav><ul>
                    <li><a href="http://blog.mathieu-leplatre.info/pages/about.html">About</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/dev.html">Dev</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/personal.html">Personal</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/sys.html">Sys</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/ux.html">Ux</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://blog.mathieu-leplatre.info/apply-debian-patches-step-by-step.html">Apply Debian patches step-by-step</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2008-08-01T09:12:00+02:00">
                Fri 01 August 2008
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.mathieu-leplatre.info/author/mathieu-leplatre.html">Mathieu Leplatre</a>
        </address>
<p>In <a href="http://blog.mathieu-leplatre.info/category/sys.html">Sys</a>. </p>
<p>tags: <a href="http://blog.mathieu-leplatre.info/tag/debian.html">debian</a><a href="http://blog.mathieu-leplatre.info/tag/howto.html">howto</a></p>
</footer><!-- /.post-info --><p>I thought it may be relevant to share the history of commands I used to apply a patch and submit it to <a class="reference external" href="http://launchpad.net">launchpad</a>.</p>
<div class="section" id="get-the-tools">
<h2>0) Get the tools</h2>
<ul>
<li><p class="first">You'll need a working PGP key</p>
</li>
<li><p class="first">Install the necessary tools</p>
<pre class="literal-block">
sudo apt-get install devscripts dpatch fakeroot dh-make
</pre>
</li>
</ul>
<p><em>(I might have forgotten some...)</em> :)</p>
</div>
<div class="section" id="get-the-files">
<h2>1) Get the files</h2>
<ul>
<li><p class="first">Get the last package source, from the package page : <a class="reference external" href="http://packages.ubuntu.com/hardy/exaile">http://packages.ubuntu.com/hardy/exaile</a></p>
<pre class="literal-block">
dget -x http://archive.ubuntu.com/ubuntu/pool/universe/e/exaile/exaile_0.2.11.1-0ubuntu3.dsc
</pre>
</li>
<li><p class="first">Get the patch file</p>
<pre class="literal-block">
wget http://launchpadlibrarian.net/9466876/gui_track_filter.patch
</pre>
</li>
<li><p class="first">Step in the package code</p>
<pre class="literal-block">
cd exaile-0.2.11.1/
</pre>
</li>
</ul>
</div>
<div class="section" id="apply-the-patch">
<h2>2) Apply the patch</h2>
<ul>
<li><p class="first">Have a look at the list of patches in the <cite>debian/patches</cite> folder</p>
<pre class="literal-block">
ls debian/patches/

00list
01_fix_makefile_for_pysupport.dpatch
02_files-on-share-dir.dpatch
03_fix_mmkeys.dpatch
</pre>
</li>
<li><p class="first">Create yours respecting dpatch filenames pattern (without extension)</p>
<pre class="literal-block">
dpatch-edit-patch 04_fix_search_exit
</pre>
</li>
<li><p class="first">You now have a shell in the <cite>/tmp</cite> folder.</p>
</li>
<li><p class="first">Apply the patch file</p>
<pre class="literal-block">
patch -p0 &lt; $HOME/Desktop/gui_track_filter.patch
</pre>
</li>
<li><p class="first">Exit the shell</p>
</li>
</ul>
</div>
<div class="section" id="describe-your-changes">
<h2>3) Describe your changes</h2>
<ul>
<li><p class="first">Add your dpatch name in the <cite>00list</cite> file</p>
<pre class="literal-block">
nano debian/patches/00list
</pre>
</li>
<li><p class="first">Modify Debian changelog using</p>
<pre class="literal-block">
dch -i
</pre>
</li>
<li><p class="first">Your name and signing information will be automatically added.</p>
</li>
<li><p class="first">Look at previous descriptions and respect their structure.</p>
</li>
<li><p class="first">Include launchpad bug number with <cite>(LP: #number)</cite> string</p>
<pre class="literal-block">
exaile (0.2.11.1-0ubuntu4) hardy; urgency=low
</pre>
</li>
<li><p class="first"><cite>debian/patches/04_fix_search_exit.dpatch</cite></p>
<pre class="literal-block">
debian/patches/00list:
- Fix clean search terms on exit (LP: #95860)

-- Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;  Tue, 27 May 2008 10:45:42 -0300
</pre>
</li>
</ul>
</div>
<div class="section" id="create-debdiff">
<h2>4) Create debdiff</h2>
<ul>
<li><p class="first">Create the dsc and diff files using</p>
<pre class="literal-block">
debuild -S
cd ..
</pre>
</li>
<li><p class="first">Step in the package code</p>
</li>
<li><p class="first">Create the debdiff file using</p>
<pre class="literal-block">
debdiff exaile_0.2.11.1-0ubuntu3.dsc exaile_0.2.11.1-0ubuntu4.dsc &gt; exaile_0.2.11.1-0ubuntu4.debdiff
</pre>
</li>
<li><p class="first">Have a look at it, it should include all modifications of previous steps</p>
<pre class="literal-block">
diff -Nru exaile-0.2.11.1/debian/changelog exaile-0.2.11.1/debian/changelog
--- exaile-0.2.11.1/debian/changelog        2008-05-27 10:54:56.000000000 -0300
+++ exaile-0.2.11.1/debian/changelog        2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -1,3 +1,11 &#64;&#64;
+exaile (0.2.11.1-0ubuntu4) hardy; urgency=low
+
+  * debian/patches/04_fix_search_exit.dpatch,
+    debian/patches/00list:
+    - Fix clean search terms on exit (LP: #95860)
+
+ -- Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;  Tue, 27 May 2008 10:45:42 -0300
+
 exaile (0.2.11.1-0ubuntu3) hardy; urgency=low

   * debian/patches/03_fix_mmkeys.dpatch,
diff -Nru /tmp/RIBRnUlXkn/exaile-0.2.11.1/debian/patches/00list /tmp/XQpuhOBOst/exaile-0.2.11.1/debian/patches/00l
ist
--- exaile-0.2.11.1/debian/patches/00list   2008-05-27 10:54:56.000000000 -0300
+++ exaile-0.2.11.1/debian/patches/00list   2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -1,3 +1,5 &#64;&#64;
 01_fix_makefile_for_pysupport
 02_files-on-share-dir
 03_fix_mmkeys
+04_fix_search_exit
+
diff -Nru /tmp/RIBRnUlXkn/exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch /tmp/XQpuhOBOst/exaile-0.2.11.1
/debian/patches/04_fix_search_exit.dpatch
--- exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch        1969-12-31 21:00:00.000000000 -0300
+++ exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch        2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -0,0 +1,27 &#64;&#64;
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 04_fix_search_exit.dpatch by Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: Patch to clean search terms on exit
+
+&#64;DPATCH&#64;
+diff -urNad exaile-0.2.11.1~/xl/gui/main.py exaile-0.2.11.1/xl/gui/main.py
+--- exaile-0.2.11.1~/xl/gui/main.py        2007-11-07 13:12:52.000000000 -0300
++++ exaile-0.2.11.1/xl/gui/main.py 2008-05-27 10:37:36.000000000 -0300
+&#64;&#64; -1659,8 +1659,16 &#64;&#64;
+         queuefile = xl.path.get_config('queued.save')
+         if os.path.isfile(queuefile):
+             os.unlink(queuefile)
++
+
+         if self.player.current: self.player.current.stop()
++
++        # Clear the search filter so that the entire playlist is saved
++        self.tracks_filter.set_text('')
++        try:
++            self.on_search()
++        except:  # In case we're quitting before the playlist loaded
++            pass
+
+         for i in range(self.playlists_nb.get_n_pages()):
+             page = self.playlists_nb.get_nth_page(i)
</pre>
</li>
</ul>
</div>
<p>There are <a href="http://blog.mathieu-leplatre.info/apply-debian-patches-step-by-step.html#disqus_thread">comments</a>.</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="http://www.linkedin.com/in/leplatre">LinkedIn</a></li>
                            <li><a href="https://code.launchpad.net/~mathieu.leplatre">Launchpad</a></li>
                            <li><a href="https://github.com/leplatrem">GitHub</a></li>
                            <li><a href="https://plus.google.com/u/0/106965745149150173373">Google+</a></li>
                            <li><a href="http://twitter.com/leplatrem">Twitter</a></li>
                            <li><a href="http://identi.ca/leplatrem">Identi.ca</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://mathieu-leplatre.info/piwik/" : "http://mathieu-leplatre.info/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://mathieu-leplatre.info/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<script type="text/javascript">
    var disqus_shortname = 'mathieuleplatre';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>