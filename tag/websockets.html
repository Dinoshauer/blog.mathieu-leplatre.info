<!DOCTYPE html>
<html lang="en">
<head>
        <title>Mathieu Leplatre - websockets</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://blog.mathieu-leplatre.info/theme/css/main.css" type="text/css" />
        <link href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mathieu Leplatre Atom Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie.css"/>
                <script src="http://blog.mathieu-leplatre.info/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://blog.mathieu-leplatre.info/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="https://github.com/leplatrem">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://blog.mathieu-leplatre.info/">Mathieu Leplatre </a></h1>
                <nav><ul>
                    <li><a href="http://blog.mathieu-leplatre.info/pages/about.html">About</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/dev.html">Dev</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/personal.html">Personal</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/sys.html">Sys</a></li>
                    <li ><a href="http://blog.mathieu-leplatre.info/category/ux.html">Ux</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://blog.mathieu-leplatre.info/des-cartes-collaboratives-avec-livetitude-fr.html">Des cartes collaboratives avec Livetitude</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2011-11-23T14:00:00+01:00">
                Wed 23 November 2011
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.mathieu-leplatre.info/author/mathieu-leplatre.html">Mathieu Leplatre</a>
        </address>
<p>In <a href="http://blog.mathieu-leplatre.info/category/dev.html">Dev</a>. </p>
<p>tags: <a href="http://blog.mathieu-leplatre.info/tag/maps.html">maps</a><a href="http://blog.mathieu-leplatre.info/tag/gis.html">gis</a><a href="http://blog.mathieu-leplatre.info/tag/websockets.html">websockets</a><a href="http://blog.mathieu-leplatre.info/tag/leaflet.html">leaflet</a><a href="http://blog.mathieu-leplatre.info/tag/heroku.html">heroku</a></p>
</footer><!-- /.post-info --><p><em>Article original publié chez</em> <a class="reference external" href="http://makina-corpus.org">Makina Corpus</a></p>
<p>Cela fait plusieurs semaines que je voulais présenter ma petite application
de partage de cartes, dont je me sers déjà comme alternative aux marqueurs de Google Maps.</p>
<div class="section" id="en-bref">
<h2>En bref</h2>
<p><a class="reference external" href="https://github.com/makinacorpus/livetitude">Livetitude</a> est un outil Web pour créer des cartes de manière collaborative
<strong>en temps réel</strong> (à la manière d'un <a class="reference external" href="http://fr.wikipedia.org/wiki/EtherPad">pad</a>).</p>
<p>Fonctionnant sur des terminaux mobiles, Livetitude permet également de partager la position des collaborateurs de la carte,
d'exporter les données au format GeoJSON ou de publier la carte sur une page Web.</p>
</div>
<div class="section" id="sous-le-capot">
<h2>Sous le capot</h2>
<p>J'ai pris du plaisir à hacker cette application, elle tire profit
d'outils très simples mais très efficaces :</p>
<ul class="simple">
<li><a class="reference external" href="http://http://leaflet.cloudmade.com">Leaflet</a> pour afficher les cartes ;</li>
<li><a class="reference external" href="http://pusher.com">Pusher</a> (Websockets) pour la collaboration en temps réel ;</li>
<li><a class="reference external" href="http://couchdb.apache.org/">CouchDB</a> pour stocker les données ;</li>
<li><a class="reference external" href="http://flask.pocoo.org">Flask</a> pour servir les pages ;</li>
<li><a class="reference external" href="http://www.heroku.com">Heroku</a> pour héberger l'application.</li>
</ul>
<p>Bien entendu, le code source est libre et disponible sur <a class="reference external" href="https://github.com/makinacorpus/livetitude">le GitHub de Makina Corpus</a>.</p>
</div>
<div class="section" id="utilisation">
<h2>Utilisation</h2>
<p>Une instance est <a class="reference external" href="http://vivid-warrior-6693.herokuapp.com/">déployée en ligne</a>, dans le cloud d'Heroku,
dont vous pouvez vous servir, <em>pour une utilisation en bon père de famille</em> :)</p>
<p>Les marqueurs peuvent contenir du texte ou de l'HTML, et aucune donnée de localisation des visiteurs n'est stockée.</p>
<img alt="" src="/images/livetitude-poc.png" />
<div class="section" id="comment-publier-vos-donnees-existantes">
<h3>Comment publier vos données existantes ?</h3>
<p>Si vous souhaitez publier et visualiser vos marqueurs sur une carte de Livetitude,
il suffit de poster (<tt class="docutils literal">POST</tt>) les coordonnées de vos points sur l'URL <tt class="docutils literal"><span class="pre">http://server/&lt;CARTE&gt;/add</span></tt>.</p>
<p>Par exemple, avec une petite fonction python :</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">httplib</span><span class="o">,</span> <span class="nn">urllib</span>

<span class="n">SERVER</span> <span class="o">=</span> <span class="s">&quot;server&quot;</span>  <span class="c"># e.g. vivid-warrior-6693.herokuapp.com</span>

<span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">mapname</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/add&quot;</span> <span class="o">%</span> <span class="n">mapname</span>
    <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
       <span class="s">&#39;coords&#39;</span><span class="p">:</span> <span class="n">coords</span><span class="p">,</span>
       <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
       <span class="s">&#39;classid&#39;</span><span class="p">:</span> <span class="mi">5</span>  <span class="c"># (=color)</span>
    <span class="p">}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
               <span class="s">&quot;Accept&quot;</span><span class="p">:</span> <span class="s">&quot;text/plain&quot;</span><span class="p">}</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">SERVER</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">publish</span><span class="p">(</span><span class="s">&quot;PasLoin&quot;</span><span class="p">,</span> <span class="s">&quot;10.1,54.9&quot;</span><span class="p">,</span> <span class="s">&quot;Super resto!&quot;</span><span class="p">)</span>
<span class="n">publish</span><span class="p">(</span><span class="s">&quot;PasLoin&quot;</span><span class="p">,</span> <span class="s">&quot;19.4,65.1&quot;</span><span class="p">,</span> <span class="s">&quot;Bon mojito&quot;</span><span class="p">)</span>
</pre></div>
<p>Les points sont alors visibles en ligne sur <tt class="docutils literal"><span class="pre">http://server/PasLoin</span></tt> ou
disponible en GeoJSON sur <tt class="docutils literal"><span class="pre">http://server/PasLoin/points</span></tt>.</p>
</div>
</div>
<div class="section" id="contribuer">
<h2>Contribuer</h2>
<p>Livetitude est une application très simple, à l'état de preuve de concept. Mais
le code source est très réduit et donc très rapide à prendre en main !</p>
<p>Toutes vos <a class="reference external" href="https://github.com/makinacorpus/livetitude/issues">suggestions ou contributions</a> sont les bienvenues !</p>
</div>
<p>There are <a href="http://blog.mathieu-leplatre.info/des-cartes-collaboratives-avec-livetitude-fr.html#disqus_thread">comments</a>.</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="http://www.linkedin.com/in/leplatre">LinkedIn</a></li>
                            <li><a href="https://code.launchpad.net/~mathieu.leplatre">Launchpad</a></li>
                            <li><a href="https://github.com/leplatrem">GitHub</a></li>
                            <li><a href="https://plus.google.com/u/0/106965745149150173373">Google+</a></li>
                            <li><a href="http://twitter.com/leplatrem">Twitter</a></li>
                            <li><a href="http://identi.ca/leplatrem">Identi.ca</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://mathieu-leplatre.info/piwik/" : "http://mathieu-leplatre.info/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://mathieu-leplatre.info/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<script type="text/javascript">
    var disqus_shortname = 'mathieuleplatre';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>